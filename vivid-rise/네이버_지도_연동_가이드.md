# 네이버 지도 연동 가이드 (NCP Maps API)

Result 페이지 지도 표시를 위해 **네이버 클라우드 플랫폼(NCP) Maps API**를 등록하는 방법입니다.  
참고: [네이버맵스 API로 식당 리스트 가져오기](https://m.blog.naver.com/dossong_/223936065167)

---

## 1. 네이버 클라우드 플랫폼 가입

1. [네이버 클라우드 플랫폼](https://console.ncloud.com/) 접속 후 로그인/가입

---

## 2. Maps API 서비스 신청 (Application 등록)

1. 콘솔에서 **VPC** → **Maps** → **Application** 메뉴로 이동
2. **+ Application 등록** 클릭
3. **Application 이름**: 원하는 이름 입력 (예: `vivid-rise-map`)
4. **API 선택**: 필요한 Maps API 선택 (지도 표시만 쓰면 기본 선택만 해도 됨)
5. **서비스 환경 등록** (Dynamic Map 선택 시 필수):
   - **Web 서비스 URL**에 아래만 있으면 됩니다. **중복·불필요한 건 정리**해 두는 것이 좋습니다.
   - **실서비스:** `https://vivid-rise.vercel.app` (또는 `https://vivid-rise.vercel.app/` 둘 중 1개만)
   - **로컬:** `http://localhost:5173` (1개만)
   - **앱인토스 등:** `https://pickt-daily.private-apps.tossmini.com` 등 사용 중인 도메인만 추가
   - ❌ 삭제해도 됨: `https://vivid-rise.vercel.app/#/result` (해시 경로는 NCP에서 보통 불필요, 도메인만 검사)
   - **중요:** 이 URL 목록이 속한 **Application**의 Client ID가 앱에서 쓰는 값(`VITE_NAVER_MAP_CLIENT_ID` 또는 기본값)과 **같은 Application**이어야 지도가 로드됩니다.
6. **등록** 완료

---

## 3. Client ID 확인

1. 방금 만든 Application 선택
2. **인증 정보** 탭/버튼 클릭
3. **Client ID** 복사 (Client Secret은 지도 스크립트 로드에는 사용 안 함)

---

## 4. 앱에 Client ID 넣기

### 로컬 개발

- 프로젝트 루트에 `.env` 파일 생성 후:
  ```env
  VITE_NAVER_MAP_CLIENT_ID=여기에_복사한_Client_ID
  ```
- NCP에서 **웹 서비스 URL**에 `http://localhost:5173` 이 등록되어 있어야 함

### Vercel 실서비스

1. Vercel 대시보드 → 해당 프로젝트 → **Settings** → **Environment Variables**
2. **Key**: `VITE_NAVER_MAP_CLIENT_ID`  
   **Value**: NCP에서 복사한 Client ID  
3. **Environment**: Production (필요 시 Preview, Development도 동일 값으로 추가)
4. NCP에서 **웹 서비스 URL**에 `https://vivid-rise.vercel.app` 이 등록되어 있어야 함

---

## 5. 확인

- 로컬: `npm run dev` 후 Result 페이지(오늘 뭐 먹지 → 결과 지도) 접속
- 실서비스: https://vivid-rise.vercel.app 에서 같은 경로로 접속

지도가 뜨면 연동 완료입니다.  
지도가 안 뜨고 OpenStreetMap으로 대체되면:

- NCP **웹 서비스 URL**에 현재 접속 중인 주소가 **정확히** 등록됐는지 확인
- `.env` 또는 Vercel 환경 변수에 `VITE_NAVER_MAP_CLIENT_ID` 가 설정됐는지 확인
- 브라우저 개발자 도구 **Console** 에 `[네이버 지도]` 로 시작하는 에러 메시지가 있는지 확인

---

## 참고: 지역 검색 API (식당 주소/이미지)

지도 **표시**는 위 NCP Maps로 하고, **식당 검색·주소·이미지**는 **네이버 검색 API > 지역 검색**을 씁니다.

- [네이버 개발자센터 > 검색 > 지역](https://developers.naver.com/docs/serviceapi/search/local/local.md)
- 앱에서는 `api/naver-place.js` (Vercel Serverless)가 이 API를 호출
- Vercel 환경 변수: `NAVER_CLIENT_ID`, `NAVER_CLIENT_SECRET` (네이버 개발자센터에서 발급)

NCP Maps Client ID와 네이버 검색 API Client ID는 **서로 다를 수 있습니다** (각각 해당 콘솔에서 발급).

---

## 연동이 안 될 때 (https://vivid-rise.vercel.app)

**무슨 말이냐면:**  
우리 사이트가 지도를 쓰려면 **NCP에 “이 주소에서 지도 쓸게요”라고 등록**해야 하고,  
사이트는 **그때 쓰기로 한 Client ID**로 지도 스크립트를 불러옵니다.  
그래서 **“등록한 URL”**과 **“사이트가 쓰는 Client ID”**가 **같은 Application**에 있어야 합니다.

---

### 1단계: NCP에서 “어느 Application” 쓰는지 정하기

- 우리 앱 코드(`naverMapLoader.js`)는 지도를 부를 때 **Client ID**를 씁니다.
- 그 Client ID는 두 가지 중 하나입니다.
  - **Vercel에 환경 변수를 넣었다면** → `VITE_NAVER_MAP_CLIENT_ID` 에 넣은 값
  - **안 넣었다면** → 코드에 적혀 있는 기본값 **`tfdaiuu9rx`**
- 즉, **NCP 콘솔에서 Client ID가 위 값인 Application**을 찾으면 됩니다.

### 2단계: 그 Application에 우리 사이트 주소 넣기

- NCP 콘솔 → **Maps** → **Application** → 방금 정한 Application 선택
- **서비스 환경 등록** → **Web 서비스 URL**에 아래가 **반드시** 들어 있어야 합니다.
  - `https://vivid-rise.vercel.app` 또는 `https://vivid-rise.vercel.app/` (둘 중 하나만 있어도 됨)
- `https://vivid-rise.vercel.app/#/result` 같은 건 빼도 됩니다 (경로까지는 안 봅니다).

**정리:**  
“사이트가 쓰는 Client ID” = “그 ID를 가진 NCP Application”이고,  
그 Application의 Web 서비스 URL 목록에 `https://vivid-rise.vercel.app` 이 있어야 지도가 뜹니다.

### 3단계: Vercel 환경 변수 (Client ID를 바꿀 때만)

- **Vercel** 대시보드 → 프로젝트 → **Settings** → **Environment Variables**
- **Key:** `VITE_NAVER_MAP_CLIENT_ID`  
  **Value:** NCP에서 복사한 **Client ID**
- **Environment:** 최소 **Production** 선택 후 저장
- 이걸 넣거나 수정했다면 **한 번 Redeploy** 해야 새 값이 적용됩니다. (Deployments → ⋮ → Redeploy)

### 4단계: 에러 메시지로 확인

- 브라우저에서 https://vivid-rise.vercel.app 접속 → 오늘 뭐 먹지 진행해서 **지도 나오는 결과 화면**으로 이동
- **F12** → **Console** 탭
- `[네이버 지도]` 또는 `naver.maps` 관련 에러가 있으면, 보통 “이 URL은 허용되지 않음” 같은 메시지가 나옵니다.  
  → 그때는 1·2단계(같은 Application에 이 URL 등록)를 다시 확인하면 됩니다.
